---
import config from "@/config.json";
---

<script
  is:inline
  type="module"
  define:vars={{ defaultTheme: config.settings.default_theme }}
>
  if (window.theme_script) {
    return;
  }
  window.theme_script = true;

  import { attachEvent } from "@/scripts/utils.ts";

  function applyTheme(theme) {
    if (theme === "dark") {
      document.documentElement.classList.add("dark");
    } else {
      document.documentElement.classList.remove("dark");
    }
  }

  const initTheme = function () {
    if (
      (defaultTheme && defaultTheme.endsWith(":only")) ||
      (!localStorage.theme && defaultTheme !== "system")
    ) {
      applyTheme(defaultTheme.replace(":only", ""));
    } else if (
      localStorage.theme === "dark" ||
      (!("theme" in localStorage) &&
        window.matchMedia("(prefers-color-scheme: dark)").matches)
    ) {
      applyTheme("dark");
    } else {
      applyTheme("light");
    }
  };
  initTheme();

  const onLoad = function () {
    attachEvent("[data-aw-toggle-color-scheme]", "click", function () {
      if (defaultTheme.endsWith(":only")) {
        return;
      }
      document.documentElement.classList.toggle("dark");
      localStorage.theme = document.documentElement.classList.contains("dark")
        ? "dark"
        : "light";
    });
  };
</script>
