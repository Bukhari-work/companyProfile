---
import Main from "@/layouts/Main.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import { getEntry, type CollectionEntry } from "astro:content";

import SideBar from "@/components/SideBar.astro";
import PeopleDeck from "@/components/PeopleDeck.astro";
import AuthorCard from "@/components/blocks/AuthorCard.astro";

const PEOPLE_FOLDER = "people";

// Fetch all entries from the 'people' collection
const people: CollectionEntry<"people">[] = await getSinglePage(PEOPLE_FOLDER);

// Define the desired order for 'responsibility'
const responsibilityOrder = [
  "Advisor",
  "Director",
  "Executive Secretary",
  "Office Manager",
  "Epidemiologist & Statistician",
  "Program & Training Specialist",
  "International Collaboration",
  "Public Relation & Marketing",
  "Data Management Specialist",
  "General Affairs",
];

// Filter the people to show only those with role = "The Team"
const advisors = people.filter((person) => person.data.role === "Advisors");
const leadership = people.filter((person) => person.data.role === "Leadership");
const teamMembers = people.filter((person) => person.data.role === "The Team");

// Sort the filtered team members based on the responsibility order
const sortedTeamMembers = teamMembers.sort((a, b) => {
  const aIndex = responsibilityOrder.indexOf(a.data.responsibility || "");
  const bIndex = responsibilityOrder.indexOf(b.data.responsibility || "");
  return aIndex - bIndex;
});

// Attributes for the Main layout
const content = { title: "About Us - Team" };
---

<Main content={content}>
  <section class="mx-auto grid max-w-6xl grid-cols-5 gap-6 p-2 xl:gap-16">
    <SideBar class="col-span-5 lg:col-span-1" />
    <article
      class="prose dark:prose-invert col-span-5 min-w-full text-justify font-light lg:col-span-4"
    >
      <h1
        class="font-lexend text-primary mt-0 mb-2 w-fit scroll-mt-24 text-6xl font-semibold lg:mt-8"
      >
        THE TEAM
      </h1>
      <div class="w-fit">
        <div>
          <!-- <h2>Advisors</h2>
          <div class="not-prose grid h-full lg:grid-cols-2">
            {
              advisors.map((person) => (
                <div class="col-span-1">
                  <AuthorCard data={person} className="m-3" />
                </div>
              ))
            }
          </div>
        </div>
        <div>
          <h2>The Team</h2>
          <div class="not-prose grid h-full lg:grid-cols-2">
            {
              sortedTeamMembers.map((person) => (
                <AuthorCard data={person} className="m-3" />
              ))
            }
          </div> -->
          <h2>Advisors</h2>
          <div class="not-prose">
            <PeopleDeck people={advisors} />
          </div>
          <h2>Leadership</h2>
          <div class="not-prose">
            <PeopleDeck people={leadership} />
          </div>
          <h2>Leadership</h2>
          <div class="not-prose mb-24">
            <PeopleDeck people={sortedTeamMembers} />
          </div>
        </div>
      </div>
    </article>
  </section>
</Main>
