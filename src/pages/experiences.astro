---
import Main from "@/layouts/Main.astro";

import SideBar from "@/components/SideBar.astro";
import PageHeader from "@/components/blocks/PageHeader.astro";

// Attributes
const content = { title: "Experiences" };
---

<Main content={content}>
  <PageHeader title={content.title} />
  <article class="mx-auto grid max-w-6xl grid-cols-5 gap-6 p-6 pb-24 xl:gap-16">
    <section
      id="process"
      class="prose dark:prose-invert col-span-5 flex min-w-full flex-col content-center items-center text-justify font-light lg:col-span-5"
    >
      <div class="mx-auto max-w-3xl text-center">
        <p class="font-lexend mt-4 text-lg">
          We follow a structured, collaborative process to ensure the final
          product perfectly aligns with your vision and goals.
        </p>
      </div>
      <div class="relative mt-16">
        <div
          class="absolute top-0 left-1/2 -ml-px hidden h-full border-l-2 border-dashed border-gray-300 md:block"
        >
        </div>
        <div class="space-y-12 md:space-y-0">
          <div class="items-center md:grid md:grid-cols-2 md:gap-x-12">
            <div class="text-center md:pr-12 md:text-right">
              <div class="text-primary text-4xl font-bold">01</div>
              <h3 class="text-primary mt-2 text-2xl font-semibold">
                Discovery & Planning
              </h3>
              <p class="mt-2">
                We begin with a deep dive into your requirements, goals, and
                content strategy, culminating in a clear site map.
              </p>
            </div>
            <div class="hidden md:block"></div>
          </div>
          <div class="items-center md:grid md:grid-cols-2 md:gap-x-12">
            <div class="hidden md:block"></div>
            <div class="text-center md:pl-12 md:text-left">
              <div class="text-primary text-4xl font-bold">02</div>
              <h3 class="text-primary mt-2 text-2xl font-semibold">
                Design & Prototyping
              </h3>
              <p class="mt-2">
                Next, we create wireframes and visual mockups. This is a
                collaborative phase with ample opportunity for feedback.
              </p>
            </div>
          </div>
          <div class="items-center md:grid md:grid-cols-2 md:gap-x-12">
            <div class="text-center md:pr-12 md:text-right">
              <div class="text-primary text-4xl font-bold">03</div>
              <h3 class="text-primary mt-2 text-2xl font-semibold">
                Development
              </h3>
              <p class="mt-2">
                With the design approved, we write clean, efficient code (HTML,
                CSS, JS) to bring the designs to life.
              </p>
            </div>
            <div class="hidden md:block"></div>
          </div>
          <div class="items-center md:grid md:grid-cols-2 md:gap-x-12">
            <div class="hidden md:block"></div>
            <div class="text-center md:pl-12 md:text-left">
              <div class="text-primary text-4xl font-bold">04</div>
              <h3 class="text-primary mt-2 text-2xl font-semibold">
                Testing & Launch
              </h3>
              <p class="mt-2">
                Finally, we rigorously test across all devices and browsers
                before deploying the site to your live server.
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section
      class="prose dark:prose-invert col-span-5 flex min-w-full flex-col content-center items-center text-justify font-light lg:col-span-5"
    >
      <div class="container mx-auto px-4 py-12 sm:px-6 sm:py-16 lg:px-8">
        <header class="mb-12 text-center">
          <h3 class="mb-4 text-xl font-bold sm:text-3xl">Our Partners</h3>
          <p class="mx-auto max-w-3xl text-lg text-slate-600">
            At the forefront of public health innovation, our institute has a
            rich history of impactful projects. Our experience spans critical
            areas of research, training, and consultation, all dedicated to
            advancing public health outcomes on local, national, and global
            scales.
          </p>
        </header>

        <nav class="mb-8 flex justify-center border-b border-slate-200">
          <div
            id="tabs-container"
            class="-mb-px flex flex-wrap justify-center space-x-2 sm:space-x-4"
          >
            <button
              data-tab="research"
              class="tab-btn active rounded-t-lg border-b-2 border-transparent px-4 py-3 text-base font-semibold transition-colors duration-300 hover:border-teal-500 hover:bg-teal-50 sm:px-6 sm:text-lg"
            >
              üî¨ Pioneering Research
            </button>
            <button
              data-tab="training"
              class="tab-btn rounded-t-lg border-b-2 border-transparent px-4 py-3 text-base font-semibold transition-colors duration-300 hover:border-teal-500 hover:bg-teal-50 sm:px-6 sm:text-lg"
            >
              üéì Capacity Building
            </button>
            <button
              data-tab="consultation"
              class="tab-btn rounded-t-lg border-b-2 border-transparent px-4 py-3 text-base font-semibold transition-colors duration-300 hover:border-teal-500 hover:bg-teal-50 sm:px-6 sm:text-lg"
            >
              ü§ù Expert Consultation
            </button>
          </div>
        </nav>

        <main>
          <!-- Research Panel -->
          <div id="research" class="content-panel active">
            <div class="mb-10 text-center">
              <h2 class="mb-2 text-3xl font-bold text-slate-800">
                Featured Research Projects
              </h2>
              <p class="mx-auto max-w-2xl text-slate-600">
                We employ rigorous methodologies to generate evidence that
                informs policy and practice. Click on a project to explore our
                key findings and impact.
              </p>
            </div>
            <div id="research-projects-container" class="space-y-6">
              <!-- JS will populate this -->
            </div>
          </div>

          <!-- Training Panel -->
          <div id="training" class="content-panel">
            <div class="mb-10 text-center">
              <h2 class="mb-2 text-3xl font-bold text-slate-800">
                Empowering Health Professionals
              </h2>
              <p class="mx-auto max-w-2xl text-slate-600">
                Our training programs are designed to be practical and
                evidence-based, equipping participants with skills to excel in
                public health.
              </p>
            </div>
            <div class="grid grid-cols-1 items-center gap-8 lg:grid-cols-2">
              <div class="space-y-6">
                <div
                  class="rounded-lg border border-slate-200 bg-white p-6 shadow-md"
                >
                  <h3 class="mb-2 text-xl font-bold text-teal-700">
                    Advanced Course in Health Policy & Systems Research
                  </h3>
                  <p class="mb-3 text-slate-600">
                    <strong class="text-slate-700">Audience:</strong> Health professionals,
                    policymakers, researchers.
                  </p>
                  <p class="text-slate-600">
                    <strong class="text-slate-700">Modules:</strong> Health Economics,
                    Policy Analysis, Implementation Science, Health Informatics.
                  </p>
                </div>
                <div
                  class="rounded-lg border border-slate-200 bg-white p-6 shadow-md"
                >
                  <h3 class="mb-2 text-xl font-bold text-teal-700">
                    Field Epidemiology Training Workshop
                  </h3>
                  <p class="mb-3 text-slate-600">
                    <strong class="text-slate-700">Audience:</strong> Public health
                    officers, field investigators.
                  </p>
                  <p class="text-slate-600">
                    <strong class="text-slate-700">Modules:</strong> Outbreak Investigation,
                    Surveillance Data Analysis, Public Health Communication.
                  </p>
                </div>
              </div>
              <div
                class="rounded-lg border border-slate-200 bg-white p-6 text-center shadow-lg"
              >
                <h3 class="mb-4 text-2xl font-bold text-slate-800">
                  Our Impact in Numbers
                </h3>
                <div class="mb-6">
                  <p
                    class="text-6xl font-bold text-teal-600"
                    id="trained-professionals-counter"
                  >
                    0
                  </p>
                  <p class="text-lg text-slate-600">Professionals Trained</p>
                </div>
                <p class="mb-4 text-slate-600">
                  The chart below illustrates the participation in our flagship
                  programs, highlighting our commitment to broad-based capacity
                  building.
                </p>
                <div class="chart-container">
                  <canvas id="trainingChart"></canvas>
                </div>
              </div>
            </div>
          </div>

          <!-- Consultation Panel -->
          <div id="consultation" class="content-panel">
            <div class="mb-10 text-center">
              <h2 class="mb-2 text-3xl font-bold text-slate-800">
                Strategic Consultation Services
              </h2>
              <p class="mx-auto max-w-2xl text-slate-600">
                We translate research into actionable strategies that strengthen
                health systems and improve population health for our partners.
              </p>
            </div>
            <div
              class="grid grid-cols-1 gap-6 text-center sm:grid-cols-2 lg:grid-cols-4"
            >
              <div
                class="rounded-lg border border-slate-200 bg-white p-6 shadow-md transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
              >
                <span class="mb-4 inline-block text-5xl">üè•</span>
                <h3 class="text-xl font-bold text-slate-800">
                  Health System Strengthening
                </h3>
              </div>
              <div
                class="rounded-lg border border-slate-200 bg-white p-6 shadow-md transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
              >
                <span class="mb-4 inline-block text-5xl">üìä</span>
                <h3 class="text-xl font-bold text-slate-800">
                  Monitoring & Evaluation
                </h3>
              </div>
              <div
                class="rounded-lg border border-slate-200 bg-white p-6 shadow-md transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
              >
                <span class="mb-4 inline-block text-5xl">üìú</span>
                <h3 class="text-xl font-bold text-slate-800">
                  Health Policy Development
                </h3>
              </div>
              <div
                class="rounded-lg border border-slate-200 bg-white p-6 shadow-md transition-all duration-300 hover:-translate-y-1 hover:shadow-xl"
              >
                <span class="mb-4 inline-block text-5xl">üìà</span>
                <h3 class="text-xl font-bold text-slate-800">
                  Data Analytics & Visualization
                </h3>
              </div>
            </div>
          </div>
        </main>
      </div>
      <p class="text-center">
        Want to work with us? contact us at <a href="mailto:champs@ui.ac.id"
          >champs@ui.ac.id</a
        >.
      </p>
    </section>
  </article>

  <style>
    body {
      font-family: "Inter", sans-serif;
    }
    .chart-container {
      position: relative;
      width: 100%;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      height: 350px;
      max-height: 400px;
    }
    .tab-btn.active {
      background-color: #0d9488; /* teal-600 */
      color: white;
      border-color: #0d9488; /* teal-600 */
    }
    .content-panel {
      display: none;
    }
    .content-panel.active {
      display: block;
    }
    .project-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-out;
    }
    .project-card.open .project-details {
      max-height: 500px; /* Adjust as needed */
    }
    .project-card.open .icon-plus {
      transform: rotate(45deg);
    }
  </style>
  <script is:inline>
    document.addEventListener("astro:page-load", function () {
      const researchProjects = [
        {
          title:
            "Epidemiological Trends of Non-Communicable Diseases in Southeast Asia",
          description:
            "A longitudinal study tracking the prevalence and risk factors of diseases like diabetes, cardiovascular conditions, and cancer across urban and rural populations.",
          outcomes: [
            "Identified key socio-economic determinants influencing disease patterns.",
            "Developed a predictive model for future public health burdens, now used by regional health ministries.",
            "Published findings in leading peer-reviewed journals, contributing to global health discourse.",
          ],
        },
        {
          title:
            "Evaluating the Efficacy of Community-Based Mental Health Interventions",
          description:
            "A multi-site randomized controlled trial assessing the impact of localized mental health support systems in underserved communities.",
          outcomes: [
            "Demonstrated a significant reduction in mental health stigma and improved access to care.",
            "Created a scalable and cost-effective intervention model that has been adopted by national health services.",
            "Informed new national guidelines for community mental health care.",
          ],
        },
        {
          title:
            "Impact of Climate Change on Vector-Borne Disease Transmission",
          description:
            "An integrated modeling study forecasting the effects of changing environmental conditions on the spread of diseases like Dengue and Malaria.",
          outcomes: [
            "Produced high-resolution risk maps to guide public health preparedness and response efforts.",
            "Developed early-warning systems for potential outbreaks based on climate data.",
            "Fostered international collaboration between environmental and public health agencies.",
          ],
        },
      ];

      const projectsContainer = document.getElementById(
        "research-projects-container",
      );
      if (projectsContainer) {
        researchProjects.forEach((project) => {
          const outcomesList = project.outcomes
            .map(
              (outcome) =>
                `<li class="flex items-start"><span class="text-teal-500 mr-2 mt-1">‚úî</span><span>${outcome}</span></li>`,
            )
            .join("");
          const projectCardHTML = `
                          <div class="project-card bg-white rounded-lg shadow-md border border-slate-200 overflow-hidden">
                              <button class="w-full text-left p-6 flex justify-between items-center focus:outline-none">
                                  <h3 class="font-bold text-xl text-teal-700">${project.title}</h3>
                                  <span class="icon-plus text-teal-500 text-3xl font-light transition-transform duration-300">+</span>
                              </button>
                              <div class="project-details px-6 pb-6">
                                  <p class="text-slate-600 mb-4">${project.description}</p>
                                  <ul class="space-y-2 text-slate-700">
                                      ${outcomesList}
                                  </ul>
                              </div>
                          </div>`;
          projectsContainer.innerHTML += projectCardHTML;
        });
      }

      projectsContainer.addEventListener("click", function (e) {
        const button = e.target.closest("button");
        if (button) {
          const card = button.closest(".project-card");
          if (card) {
            card.classList.toggle("open");
          }
        }
      });

      const tabsContainer = document.getElementById("tabs-container");
      const contentPanels = document.querySelectorAll(".content-panel");
      let trainingChartInstance = null;

      tabsContainer.addEventListener("click", function (e) {
        const button = e.target.closest(".tab-btn");
        if (!button) return;

        const tabId = button.dataset.tab;

        document
          .querySelectorAll(".tab-btn")
          .forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");

        contentPanels.forEach((panel) => {
          if (panel.id === tabId) {
            panel.classList.add("active");
          } else {
            panel.classList.remove("active");
          }
        });

        if (tabId === "training") {
          animateCounter(500);
          if (!trainingChartInstance) {
            renderTrainingChart();
          }
        }
      });

      function animateCounter(target) {
        const counterElement = document.getElementById(
          "trained-professionals-counter",
        );
        let current = 0;
        const increment = target / 100;
        const interval = setInterval(() => {
          current += increment;
          if (current >= target) {
            clearInterval(interval);
            counterElement.textContent = `${target}+`;
          } else {
            counterElement.textContent = Math.ceil(current);
          }
        }, 20);
      }

      function wrapText(ctx, text, maxWidth) {
        const words = text.split(" ");
        let lines = [];
        let currentLine = words[0];

        for (let i = 1; i < words.length; i++) {
          let word = words[i];
          let width = ctx.measureText(currentLine + " " + word).width;
          if (width < maxWidth) {
            currentLine += " " + word;
          } else {
            lines.push(currentLine);
            currentLine = word;
          }
        }
        lines.push(currentLine);
        return lines;
      }

      function renderTrainingChart() {
        const ctx = document.getElementById("trainingChart").getContext("2d");
        trainingChartInstance = new Chart(ctx, {
          type: "bar",
          data: {
            labels: [
              "Health Policy & Systems Research",
              "Field Epidemiology Workshop",
            ],
            datasets: [
              {
                label: "Participants",
                data: [280, 220],
                backgroundColor: [
                  "rgba(13, 148, 136, 0.6)", // teal-600 with opacity
                  "rgba(15, 118, 110, 0.6)", // teal-700 with opacity
                ],
                borderColor: ["rgb(13, 148, 136)", "rgb(15, 118, 110)"],
                borderWidth: 1,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Number of Professionals",
                },
              },
              x: {
                ticks: {
                  callback: function (value, index, values) {
                    const label = this.getLabelForValue(value);
                    if (label.length > 16) {
                      return label.split(" ").slice(0, 2).join(" ") + "...";
                    }
                    return label;
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  title: function (tooltipItems) {
                    return tooltipItems[0].label;
                  },
                },
              },
            },
          },
        });
      }
    });
  </script>
</Main>
